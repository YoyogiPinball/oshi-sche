# 推しスケ（Oshi-Sche）

> 好きが多いほど忙しい人へ
> 推しの配信予定を逃さないためのスケジュール確認ツール

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)

## 🎯 機能概要

VTuberの配信スケジュール画像をGoogleドライブにアップロードするだけで、**Gemini AI**が自動で解析し、Googleスプレッドシート＆Googleカレンダーに登録してくれるシステムです。

推しが多くて配信スケジュールを追うのだけでも一苦労な方にぴったり！

---

## ✨ 主な機能

- 📸 **画像から自動解析**: Gemini 2.0 Flash APIで配信スケジュール画像を解析
- 📊 **スプレッドシート管理**: Googleスプレッドシートに自動書き込み
- 📅 **カレンダー連携**: Googleカレンダーに予定を自動登録
- 🤖 **完全自動化**: Google Apps Scriptで定期実行
- 🔄 **重複防止**: 既に処理済みの画像は自動スキップ
- 👥 **複数VTuber対応**: フォルダ分けで複数のVTuberを管理可能
- 🧪 **ドライランモード**: 安全にテスト実行できる機能付き

---

## 🛠️ セットアップ（Step-by-Step）

### ステップ1: Gemini API キーの取得

1. [Google AI Studio](https://aistudio.google.com/) にアクセス
2. 「Get API Key」をクリック
3. APIキーをコピーして保存（後で使います）

> **注意**: 無料枠は1日1500リクエスト程度。超過すると課金が発生する可能性があります。

---

### ステップ2: Googleドライブにフォルダを作成

1. Googleドライブに以下の2つのフォルダを作成：
   - `推しスケ_入力` （スケジュール画像をアップロードするフォルダ）
   - `推しスケ_完了` （処理済み画像が移動されるフォルダ）

2. 各フォルダ内に、VTuberごとのサブフォルダを作成：
   - フォルダ名の形式: `所属：VTuber名`（全角コロン「：」を使用）
   - 例: `個人勢：白雪みしろ`、`ミクスト：雪白キャル`

3. フォルダIDをメモ：
   - フォルダを開いてURLを確認
   - `https://drive.google.com/drive/folders/【ここがフォルダID】`

---

### ステップ3: Googleスプレッドシートを作成

1. 新しいGoogleスプレッドシートを作成
2. スプレッドシートIDをメモ：
   - URLの`/d/【ここがスプレッドシートID】/edit`部分

---

### ステップ4: Googleカレンダーを作成（任意）

1. Googleカレンダーで新しいカレンダーを作成（推奨）
2. カレンダーIDをメモ：
   - カレンダー設定 → 「カレンダーの統合」
   - カレンダーIDをコピー（例: `xxxx@group.calendar.google.com`）

---

### ステップ5: GASプロジェクトを作成

1. [Google Apps Script](https://script.google.com/) にアクセス
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を「推しスケ」に変更
4. `code.gs` の内容を全て削除
5. [src/code.gs](src/code.gs) の内容をコピー＆ペースト
6. 保存（💾アイコンをクリック）

---

### ステップ6: スクリプトプロパティを設定

1. GASエディタで「プロジェクトの設定（⚙アイコン）」をクリック
2. 「スクリプトプロパティ」セクションまでスクロール
3. 「プロパティを追加」で以下を設定：

| プロパティ名 | 説明 | 取得方法 | 例 |
|-------------|------|----------|-----|
| `GEMINI_API_KEY` | Gemini APIキー | Google AI Studio | `AIza...` |
| `INPUT_FOLDER_ID` | 入力フォルダID | DriveのURL | `173ibp...` |
| `DONE_FOLDER_ID` | 処理済みフォルダID | DriveのURL | `18I6b...` |
| `SPREADSHEET_ID` | スプレッドシートID | スプシのURL | `1rWFI...` |
| `SHEET_NAME` | シート名 | 任意 | `スケジュール` |
| `CALENDAR_ID` | カレンダーID | カレンダー設定 | `xxxx@group.calendar.google.com` |
| `DRY_RUN` | ドライランモード | `true` または `false` | `true` |

> **重要**: 初回は必ず `DRY_RUN` を `true` に設定してテストしてください！

---

### ステップ7: 初回テスト実行

1. GASエディタで「実行」→「testProcessImages」を選択
2. 初回は権限の承認を求められます：
   - 「権限を確認」をクリック
   - 自分のGoogleアカウントを選択
   - 「詳細」→「推しスケ（安全ではないページ）に移動」
   - 「許可」をクリック
3. 実行ログを確認（「実行数」→「最新の実行」で確認）

**ドライランモード**では、画像解析のみ実行され、実際の書き込み・移動は行われません。

---

### ステップ8: トリガー設定（定期実行）

テストが成功したら、定期実行を設定しましょう。

1. GASエディタで「トリガー（⏰アイコン）」をクリック
2. 「トリガーを追加」をクリック
3. 以下のように設定：
   - 実行する関数: `processNewImages`
   - 実行するデプロイ: `Head`
   - イベントのソース: `時間主導型`
   - 時間ベースのトリガー: `時間ベースのタイマー`
   - 時間の間隔: `1時間ごと`（お好みで調整）
4. 「保存」をクリック

---

### ステップ9: 本番実行

ドライランでの動作確認が完了したら、本番モードに切り替えます。

1. スクリプトプロパティの `DRY_RUN` を `false` に変更
2. 再度テスト実行して、実際に書き込みが行われることを確認

---

## 📋 使い方

1. **スケジュール画像を準備**
   - VTuberが公開している配信スケジュール画像を保存

2. **Googleドライブにアップロード**
   - `推しスケ_入力/所属：VTuber名/` フォルダに画像をアップロード

3. **自動処理を待つ**
   - トリガー設定した時間間隔で自動的に処理されます
   - すぐに反映させたい場合は、GASエディタで手動実行：
     - 「実行」→「processNewImages」を選択
     - 実行ログで処理結果を確認
   - 処理が完了すると：
     - スプレッドシートにスケジュールが追加
     - カレンダーに予定が登録
     - 画像が `推しスケ_完了/所属：VTuber名/` に移動

4. **確認**
   - スプレッドシートやカレンダーで予定を確認
   - GoogleCalendarと連携済みのClaude（MCP連携）なら「今日の配信予定は？」と聞けば回答してくれます

---

## 🎨 画像フォーマットの推奨

Gemini AIの解析精度を上げるために、以下のような画像が適しています：

### ✅ 推奨
- 横書きのスケジュール画像
- シンプルなレイアウト
- 文字サイズがある程度大きいもの
- 背景と文字のコントラストが高いもの

### ⚠️ 精度が下がる可能性
- 縦書き
- 装飾過多
- 手書き風フォント
- 文字が小さすぎる
- 画像が不鮮明

**実績**: 10人以上のVTuberスケジュール画像でテスト済み、相違なしでした。

---

## 📊 動作フロー

```
[手動] Driveの「入力フォルダ/所属：VTuber名/」に画像を入れる
    ↓
[自動] GASが定期実行（トリガー設定）
    ↓
[自動] Gemini 2.0 Flashで画像解析 → スケジュールJSON抽出
    ↓
[自動] Googleスプレッドシートに書き込み
    ↓
[自動] Googleカレンダーに予定登録
    ↓
[自動] 処理済み画像を「完了フォルダ/所属：VTuber名/」に移動
    ↓
[手動] ClaudeのMCP連携で「今日の配信予定は？」と聞けば回答
```

---

## 💰 Gemini API 無料枠について

**無料枠**:
- 1分あたり15リクエスト
- 1日あたり約1500リクエスト

**注意事項**:
- 無料枠を超過すると課金が発生する可能性があります
- 大量の画像を一度に処理する場合は注意してください
- 詳細は [Google AI Studio の料金](https://ai.google.dev/pricing) を確認してください

---

## 🔒 安全に使うための権限・理由・懸念

このツールが必要とする権限と、その理由を説明します。

### 必要な権限

| 権限 | 理由 |
|------|------|
| Googleドライブへのアクセス | スケジュール画像の読み込み・移動のため |
| Googleスプレッドシートへのアクセス | スケジュールデータの書き込みのため |
| Googleカレンダーへのアクセス | 配信予定の登録のため |
| 外部サービスへの接続 | Gemini APIへのリクエスト送信のため |

### セキュリティ上の注意

- ⚠️ **APIキーは絶対に公開しないでください**
- ⚠️ GASのスクリプトプロパティに保存することで、コード内にAPIキーを直接書かずに済みます
- ⚠️ 他人と共有する場合は、自分のAPIキーを削除してから共有してください

---

## ❓ FAQ / 既知の制限

### Q: 年またぎのスケジュールは正しく処理される？

**A**: 基本的には対応済みです。以下のロジックで判定しています：

- 基本は現在の年とする
- 現在12月で、スケジュールに1月や2月がある場合は翌年
- 現在1月で、スケジュールに12月がある場合は前年

ただし、数ヶ月先のスケジュールは誤判定の可能性があります。

### Q: 複数の配信が同じ日にある場合は？

**A**: 別々のエントリとして登録されます。

### Q: スケジュール画像を更新したい場合は？

**A**:
1. 元の画像を削除
2. 新しい画像をアップロード
3. スプレッドシート・カレンダーの古い予定を手動で削除
4. 再度自動処理を待つ

### Q: 処理が実行されない

**A**: 以下を確認してください：
- トリガーが正しく設定されているか
- スクリプトプロパティが全て設定されているか
- 実行ログにエラーが出ていないか（GASエディタの「実行数」で確認）

### Q: エラーが出る

**A**: 実行ログを確認してください。エラーメッセージに対処方法が記載されています。

---

## 🛡️ 免責事項

- ⚠️ 本ツールはGemini APIを使用しています。ご利用は自己責任でお願いします。
- ⚠️ 非公式ツールです。
- ⚠️ 悪用は禁止します。
- ⚠️ 他者に迷惑をかけないようご利用ください。
- ⚠️ 個人利用の範疇でお願いします。
- ⚠️ [Gemini APIの利用規約](https://ai.google.dev/gemini-api/terms)も遵守してください。
- ⚠️ VTuberやタレントのスケジュール画像の著作権は各所属事務所・本人に帰属します。

---

## 🤝 機能の提案・バグ報告

Issue または Pull Request をお待ちしています！

- [Issue を作成](https://github.com/YoyogiPinball/oshi-sche/issues)
- [Pull Request を作成](https://github.com/YoyogiPinball/oshi-sche/pulls)

---

## 📄 ライセンス

[MIT License](LICENSE)

Copyright (c) 2025 YoyogiPinball

---

## 🚀 今後の展望

- [ ] WebUIの提供
